// ============================================
// Complete Workflow Example
// ============================================

// ============================================
// Step 1: User Login (获取 JWT Token)
// ============================================

// 1. Create User
# Create a user first
POST http://localhost:8080/api/v1/user/create
Content-Type: application/json

{
  "username": "admin",
  "nickname": "管理员",
  "password": "123456",
  "department": "技术部"
}

> {%
    client.global.set("userId", response.body.data.id)
%}

###

// 1. Login to get JWT Token
POST http://localhost:8080/api/v1/user/login
Content-Type: application/json

{
  "username": "admin",
  "password": "123456"
}

> {%
    client.global.set("token", response.body.data.token);
    client.global.set("userId", response.body.data.user.id);
%}

###

// ============================================
// Step 2: Create Category (需要 JWT)
// ============================================

// 2. Create Category
POST http://localhost:8080/api/v1/category/create
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "id": "1",
  "title": "文案生成",
  "icon": "file",
  "url": "/category/copywriting",
  "createdBy": "admin",
  "username": "管理员"
}

> {%
    client.global.set("categoryId", response.body.data.id);
%}

###

// ============================================
// Step 3: Create Prompt (需要 JWT)
// ============================================

// 3. Create Prompt with Category
POST http://localhost:8080/api/v1/prompt/create
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "文案生成助手",
  "createdBy": "admin",
  "username": "管理员",
  "path": "/text-generate",
  "category": "1"
}

> {%
    client.global.set("promptId", response.body.data.id);
%}

###

// ============================================
// Step 4: Favorites Operations (需要 JWT)
// ============================================

// 4. Add to Favorites
POST http://localhost:8080/api/v1/favorites/add
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "promptId": "{{promptId}}"
}
###

// ============================================

// 5. Check if Favorited
POST http://localhost:8080/api/v1/favorites/check
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "promptId": "{{promptId}}"
}
###

// ============================================

// 6. List Favorites
GET http://localhost:8080/api/v1/favorites/list
Authorization: Bearer {{token}}

// ============================================
// Step 5: Recently Used Operations (需要 JWT)
// ============================================
###

// 7. Record First Usage
POST http://localhost:8080/api/v1/recently-used/record
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "promptId": "{{promptId}}"
}

###

// ============================================

// 8. Record Second Usage (updates timestamp)
POST http://localhost:8080/api/v1/recently-used/record
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "promptId": "{{promptId}}"
}

###

// ============================================

// 9. List Recently Used
GET http://localhost:8080/api/v1/recently-used/list?limit=10
Authorization: Bearer {{token}}

###

// ============================================
// Step 6: Prompt Version Operations (需要 JWT)
// ============================================

// 10. Create and Publish First Version
POST http://localhost:8080/api/v1/version/create
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "promptId": "{{promptId}}",
  "version": "1.0.0",
  "content": "你是一个专业的文案生成助手，请根据用户提供的信息生成吸引人的文案。",
  "variables": "[\"topic\", \"tone\"]",
  "changeLog": "初始发布版本",
  "createdBy": "admin",
  "username": "管理员",
  "isPublish": true
}

> {%
    client.global.set("versionId", response.body.data.id);
%}

###

// ============================================

// 11. Get Prompt Content (Published)
GET http://localhost:8080/api/v1/prompt/content/text-generate
Authorization: Bearer {{token}}

###


// ============================================

// 12. Create New Version
POST http://localhost:8080/api/v1/version/create
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "promptId": "{{promptId}}",
  "version": "1.1.0",
  "content": "你是一个专业的文案生成助手，请根据用户提供的信息生成吸引人的文案。\n请确保文案简洁有力，突出产品卖点。",
  "variables": "[\"topic\", \"tone\", \"audience\"]",
  "changeLog": "优化提示词，增加受众分析",
  "createdBy": "admin",
  "username": "管理员",
  "isPublish": true
}

###

// ============================================

// 13. Get Latest Version
GET http://localhost:8080/api/v1/version/prompt/{{promptId}}/latest
Authorization: Bearer {{token}}

###

// ============================================

// 14. List All Versions
GET http://localhost:8080/api/v1/version/prompt/{{promptId}}
Authorization: Bearer {{token}}

// ============================================
// Step 7: Category Management (需要 JWT)
// ============================================

###

// 15. List Categories
GET http://localhost:8080/api/v1/category/list
Authorization: Bearer {{token}}

// ============================================

###

// 16. Update Category
POST http://localhost:8080/api/v1/category/update
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "id": "1",
  "title": "文案创作",
  "icon": "edit",
  "count": 10,
  "url": "/category/writing",
  "createdBy": "admin",
  "username": "管理员"
}

###


// ============================================
// Step 8: Cleanup Operations (需要 JWT)
// ============================================

###

// 17. Remove from Favorites
POST http://localhost:8080/api/v1/favorites/remove
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "promptId": "{{promptId}}"
}

###

// ============================================

// 18. Remove from Recently Used
POST http://localhost:8080/api/v1/recently-used/remove
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "promptId": "{{promptId}}"
}

###

// ============================================

// 19. Clean Old Records (keep 20)
POST http://localhost:8080/api/v1/recently-used/clean
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "keepCount": 20
}

###

// ============================================
// Step 9: Verify Cleanup (需要 JWT)
// ============================================

// 20. Verify Favorites Removed
POST http://localhost:8080/api/v1/favorites/check
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "promptId": "{{promptId}}"
}

###

// ============================================

// 21. Verify Recently Used List
GET http://localhost:8080/api/v1/recently-used/list?limit=10
Authorization: Bearer {{token}}

// ============================================
// Step 10: User Logout
// ============================================

###

// 22. Logout
POST http://localhost:8080/api/v1/user/logout
Content-Type: application/json

{
  "username": "admin"
}
